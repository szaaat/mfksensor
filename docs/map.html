<!DOCTYPE html>
<html lang="hu">
<head>
  <!-- ... (el≈ëz≈ë head r√©sz v√°ltozatlan) ... -->
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 font-sans min-h-screen flex flex-col">
  <!-- ... (header r√©sz v√°ltozatlan) ... -->
  
  <main class="container mx-auto p-4 flex-grow relative">
    <div class="mb-4 flex justify-center items-center gap-2">
      <label for="datePicker" class="text-md font-semibold text-gray-700">V√°lassz d√°tumot:</label>
      <input type="text" id="datePicker" class="border rounded px-2 py-1" placeholder="D√°tum kiv√°laszt√°sa" />
      <button id="exportButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Export CSV</button>
    </div>
    <div id="loading" class="loading-overlay">
      <div class="loading-spinner"></div>
      <span class="ml-4 text-lg font-semibold">Adatok bet√∂lt√©se...</span>
    </div>
    <div id="map" class="rounded-xl shadow-lg border border-gray-300"></div>
    <!-- Friss√≠tett jelmagyar√°zat -->
    <div id="legend" class="legend hidden bg-white bg-opacity-90 p-3 rounded-lg shadow-md">
      <h3 class="font-bold mb-2 text-sm">Leveg≈ëmin≈ës√©g (PM2.5)</h3>
      <div class="legend-item"><div class="legend-color rounded-full" style="background-color: #00E400;"></div> 0-12 ¬µg/m¬≥ (J√≥)</div>
      <div class="legend-item"><div class="legend-color rounded-full" style="background-color: #FFFF00;"></div> 12-35 ¬µg/m¬≥ (K√∂zepes)</div>
      <div class="legend-item"><div class="legend-color rounded-full" style="background-color: #FF7E00;"></div> 35-55 ¬µg/m¬≥ (Rossz)</div>
      <div class="legend-item"><div class="legend-color rounded-full" style="background-color: #FF0000;"></div> 55-150 ¬µg/m¬≥ (Nagyon rossz)</div>
      <div class="legend-item"><div class="legend-color rounded-full" style="background-color: #8F3F97;"></div> 150-250 ¬µg/m¬≥ (Vesz√©lyes)</div>
      <div class="legend-item"><div class="legend-color rounded-full" style="background-color: #7E0023;"></div> 250+ ¬µg/m¬≥ (Extr√©m)</div>
    </div>
    <p class="text-sm text-red-600 text-center mt-2 font-semibold">
      ‚ö†Ô∏è A m√©r√©si adatok nem hiteles√≠tettek ‚Äì t√°j√©koztat√≥ jelleg≈±ek!
    </p>
  </main>

  <!-- ... (footer r√©sz v√°ltozatlan) ... -->

  <script>
    // ... (kor√°bbi v√°ltozatlan script r√©szek) ...

    document.addEventListener('DOMContentLoaded', async () => {
      const map = new maplibregl.Map({
        container: 'map',
        style: {
          version: 8,
          sources: {
            osm: {
              type: 'raster',
              tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
              tileSize: 256,
              attribution: '¬© OpenStreetMap'
            },
            // Alap√©rtelmezett st√≠lus jav√≠t√°sa
            'hillshade': {
              type: 'raster-dem',
              url: 'https://demotiles.maplibre.org/terrain-tiles/tiles.json',
              tileSize: 256
            }
          },
          layers: [
            {
              id: 'osm-tiles',
              type: 'raster',
              source: 'osm',
              minzoom: 0,
              maxzoom: 22
            },
            // H√°tt√©r kontrasztj√°nak n√∂vel√©se
            {
              id: 'hillshade',
              type: 'hillshade',
              source: 'hillshade',
              layout: { visibility: 'none' } // Alapb√≥l ki van kapcsolva
            }
          ]
        },
        center: [20.36, 47.89],
        zoom: 8,
        // Jobb megjelen√©s √©rdek√©ben
        antialias: true,
        interactive: true,
        pitchWithRotate: true,
        attributionControl: false
      });

      // ... (tov√°bbi inicializ√°l√°sok) ...

      map.on('click', 'air_quality_points', e => {
        const p = e.features[0].properties;
        const ts = p.timestamp ? new Date(p.timestamp).toLocaleString('hu-HU') : 'N/A';
        
        // St√≠lusosabb popup design
        new maplibregl.Popup({ className: 'custom-popup', maxWidth: '300px' })
          .setLngLat(e.lngLat)
          .setHTML(`
            <div class="popup-content">
              <h3 class="font-bold text-lg mb-2 text-blue-700">M√©r√©si adatok</h3>
              <div class="grid grid-cols-2 gap-2 text-sm">
                <div><strong>Id≈ëpont:</strong></div>
                <div>${ts}</div>
                
                <div><strong>PM1.0:</strong></div>
                <div>${p.pm1_0?.toFixed(1) || '‚Äì'} ¬µg/m¬≥</div>
                
                <div><strong>PM2.5:</strong></div>
                <div>${p.pm2_5?.toFixed(1) || '‚Äì'} ¬µg/m¬≥</div>
                
                <div><strong>PM4.0:</strong></div>
                <div>${p.pm4_0?.toFixed(1) || '‚Äì'} ¬µg/m¬≥</div>
                
                <div><strong>PM10:</strong></div>
                <div>${p.pm10_0?.toFixed(1) || '‚Äì'} ¬µg/m¬≥</div>
                
                <div><strong>H≈ëm√©rs√©klet:</strong></div>
                <div>${p.temperature?.toFixed(1) || '‚Äì'} ¬∞C</div>
                
                <div><strong>P√°ratartalom:</strong></div>
                <div>${p.humidity?.toFixed(1) || '‚Äì'} %</div>
                
                <div><strong>VOC:</strong></div>
                <div>${p.voc || '‚Äì'} index</div>
                
                <div><strong>NOx:</strong></div>
                <div>${p.nox || '‚Äì'} index</div>
                
                <div><strong>CO‚ÇÇ:</strong></div>
                <div>${p.co2 || '‚Äì'} ppm</div>
              </div>
            </div>
          `)
          .addTo(map);
      });

      // Tov√°bbi t√©rk√©p megjelen√©s jav√≠t√°sok
      map.on('load', () => {
        // Jelmagyar√°zat mindig l√°that√≥
        document.getElementById('legend').classList.remove('hidden');
        
        // Kontraszt be√°ll√≠t√°sa
        map.setPaintProperty('osm-tiles', 'raster-opacity', 0.9);
        map.setPaintProperty('osm-tiles', 'raster-contrast', 0.2);
        
        // √âjszakai m√≥d opcion√°lis bekapcsol√°sa
        const toggleDarkMode = document.createElement('button');
        toggleDarkMode.innerHTML = 'üåô';
        toggleDarkMode.className = 'maplibregl-ctrl-icon maplibregl-ctrl-night-mode';
        toggleDarkMode.onclick = () => {
          map.setStyle('https://demotiles.maplibre.org/style.json'); // S√∂t√©t t√©ma
        };
        
        // Vissza√°ll√≠t√°s gomb
        const toggleLightMode = document.createElement('button');
        toggleLightMode.innerHTML = '‚òÄÔ∏è';
        toggleLightMode.className = 'maplibregl-ctrl-icon maplibregl-ctrl-day-mode';
        toggleLightMode.onclick = () => {
          map.setStyle({
            version: 8,
            sources: {
              osm: {
                type: 'raster',
                tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                tileSize: 256
              }
            },
            layers: [{
              id: 'osm-tiles',
              type: 'raster',
              source: 'osm'
            }]
          });
        };
        
        // Gombok hozz√°ad√°sa a t√©rk√©phez
        const nav = new maplibregl.NavigationControl();
        map.addControl(nav, 'top-right');
        
        // Egy√©ni gombok hozz√°ad√°sa
        const customControls = document.createElement('div');
        customControls.className = 'maplibregl-ctrl-group maplibregl-ctrl';
        customControls.appendChild(toggleDarkMode);
        customControls.appendChild(toggleLightMode);
        map.addControl({
          onAdd: function() { return customControls; },
          onRemove: function() {}
        }, 'top-right');
      });

      // ... (tov√°bbi k√≥d v√°ltozatlan) ...
    });
  </script>

  <style>
    /* Egy√©ni st√≠lusok a t√©rk√©p megjelen√©s√©hez */
    .custom-popup {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .custom-popup .maplibregl-popup-content {
      padding: 12px;
      border-radius: 6px;
    }
    
    .custom-popup .maplibregl-popup-tip {
      border-top-color: rgba(255,255,255,0.9);
    }
    
    .legend {
      background: rgba(255,255,255,0.95);
      border: 1px solid #ddd;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .legend-item {
      margin: 4px 0;
      font-size: 11px;
    }
    
    .legend-color {
      border-radius: 50%;
      border: 1px solid #666;
    }
    
    /* Responsz√≠v design */
    @media (max-width: 768px) {
      #map { height: calc(100vh - 180px); }
      .legend {
        bottom: 10px;
        left: 5px;
        padding: 5px;
        font-size: 10px;
      }
    }
  </style>
</body>
</html>